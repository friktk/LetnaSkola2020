<!doctype html><html lang=sk class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Výučbový systém BT-car3"><link href=https://friktk.github.io/LetnaSkola2020/pr5/ rel=canonical><meta name=author content="Martin Húdik"><link rel="shortcut icon" href=../images/icon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.5"><title>Príklad 5 „Fotoodpor“ - BT-car3</title><link rel=stylesheet href=../assets/stylesheets/main.df84b5fe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.8435c73a.min.css><meta name=theme-color content=#3f51b5><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/w3.css></head> <body dir data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#analogovo-cislicovy-prevodnik class=md-skip> Preskočiť na obsah </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label> <a href=https://friktk.github.io/LetnaSkola2020/ title=BT-car3 class="md-header-nav__button md-logo" aria-label=BT-car3> <img src=../images/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> BT-car3 </span> <span class="md-header-nav__topic md-ellipsis"> Príklad 5 „Fotoodpor“ </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Hľadať placeholder=Hľadať autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/friktk/LetnaSkola2020.git title="Zobraziť repozitár" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> LetnaSkola 2020 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class="md-tabs__link md-tabs__link--active"> BT-car3 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://friktk.github.io/LetnaSkola2020/ title=BT-car3 class="md-nav__button md-logo" aria-label=BT-car3> <img src=../images/logo.svg alt=logo> </a> BT-car3 </label> <div class=md-nav__source> <a href=https://github.com/friktk/LetnaSkola2020.git title="Zobraziť repozitár" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> LetnaSkola 2020 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1 checked> <label class=md-nav__link for=nav-1> BT-car3 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=BT-car3 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> BT-car3 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Úvod class=md-nav__link> Úvod </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2 checked> <label class=md-nav__link for=nav-1-2> Príklady <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Príklady data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Príklady </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../pr1/ title="Príklad 1 „RGB_LED“" class=md-nav__link> Príklad 1 „RGB_LED“ </a> </li> <li class=md-nav__item> <a href=../pr2/ title="Príklad 2 „RGB_AKU“" class=md-nav__link> Príklad 2 „RGB_AKU“ </a> </li> <li class=md-nav__item> <a href=../pr3/ title="Príklad 3 „TLAČIDLO“" class=md-nav__link> Príklad 3 „TLAČIDLO“ </a> </li> <li class=md-nav__item> <a href=../pr4/ title="Príklad 4 „UART“" class=md-nav__link> Príklad 4 „UART“ </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Príklad 5 „Fotoodpor“ <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Príklad 5 „Fotoodpor“" class="md-nav__link md-nav__link--active"> Príklad 5 „Fotoodpor“ </a> <nav class="md-nav md-nav--secondary" aria-label=Obsah> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Obsah </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#analogovo-cislicovy-prevodnik class=md-nav__link> Analógovo-číslicový prevodník </a> </li> <li class=md-nav__item> <a href=#registre-ad-prevodnika class=md-nav__link> Registre A/D prevodníka </a> <nav class=md-nav aria-label="Registre A/D prevodníka"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#admux-register-multiplexora class=md-nav__link> ADMUX: Register multiplexora </a> </li> <li class=md-nav__item> <a href=#adcsra-riadiaci-a-stavovy-register-ac-prevodnika class=md-nav__link> ADCSRA: Riadiaci a stavový register A/Č prevodníka </a> </li> <li class=md-nav__item> <a href=#datove-registre-ac-prevodnika class=md-nav__link> Dátové registre A/Č prevodníka </a> </li> <li class=md-nav__item> <a href=#adcsrb-riadiaci-a-stavovy-register-b class=md-nav__link> ADCSRB riadiaci a stavový register B </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#implementacia-triedy-adc1 class=md-nav__link> Implementácia triedy ADC1 </a> <nav class=md-nav aria-label="Implementácia triedy ADC1"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#priklady-pouzitia class=md-nav__link> Príklady použitia </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../pr6/ title="Prerušovací podsystém" class=md-nav__link> Prerušovací podsystém </a> </li> <li class=md-nav__item> <a href=../pr7.md title=PWM class=md-nav__link> PWM </a> </li> <li class=md-nav__item> <a href=https://github.com/friktk/LetnaSkola2020/archive/ulohy.zip title=Download class=md-nav__link> Download </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Cvičenia <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Cvičenia data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Cvičenia </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://github.com/friktk/LetnaSkola2020/archive/triedy_cvicenie.zip title=Knižnica class=md-nav__link> Knižnica </a> </li> <li class=md-nav__item> <a href=https://github.com/friktk/LetnaSkola2020/tree/priklady/schema title=Schémy class=md-nav__link> Schémy </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../link/ title="Odkazy a návody" class=md-nav__link> Odkazy a návody </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=Obsah> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Obsah </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#analogovo-cislicovy-prevodnik class=md-nav__link> Analógovo-číslicový prevodník </a> </li> <li class=md-nav__item> <a href=#registre-ad-prevodnika class=md-nav__link> Registre A/D prevodníka </a> <nav class=md-nav aria-label="Registre A/D prevodníka"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#admux-register-multiplexora class=md-nav__link> ADMUX: Register multiplexora </a> </li> <li class=md-nav__item> <a href=#adcsra-riadiaci-a-stavovy-register-ac-prevodnika class=md-nav__link> ADCSRA: Riadiaci a stavový register A/Č prevodníka </a> </li> <li class=md-nav__item> <a href=#datove-registre-ac-prevodnika class=md-nav__link> Dátové registre A/Č prevodníka </a> </li> <li class=md-nav__item> <a href=#adcsrb-riadiaci-a-stavovy-register-b class=md-nav__link> ADCSRB riadiaci a stavový register B </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#implementacia-triedy-adc1 class=md-nav__link> Implementácia triedy ADC1 </a> <nav class=md-nav aria-label="Implementácia triedy ADC1"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#priklady-pouzitia class=md-nav__link> Príklady použitia </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Príklad 5 „Fotoodpor“</h1> <p><strong>Projekt AVR2_0</strong></p> <p>Súčasťou dosky AVR_Board je súčiastka, ktorú nazývame fotoodpor. Fotoodpor je prvok, ktorý v závislosti od intenzity osvetlenia mení svoj odpor. Na doske AVR_Board je osadený fotoodpor GYxxxx podľa obrázka.</p> <p><img alt=image-20200713140016379 src=../images/schema_foto.png#75size#center></p> <p>Zo zapojenia je zrejmé, že fotoodpor a odpor R7 vytvárajú napäťový delič, pričom hodnota napätia Uf, na vstupe AD6 je rovná: $$ U_f=\frac{R_{FOTO}}{R7+R_{FOTO}}U_A $$ Vidíme, že veľkosť napätia <span><span class=MathJax_Preview>U_f</span><script type=math/tex>U_f</script></span> závisí od hodnoty <span><span class=MathJax_Preview>R_{FOTO}</span><script type=math/tex>R_{FOTO}</script></span> a odporu <span><span class=MathJax_Preview>R7</span><script type=math/tex>R7</script></span> a napätia <span><span class=MathJax_Preview>U_A</span><script type=math/tex>U_A</script></span>, ktoré sú konštantné. Jediná premenlivá veličina v predchádzajúcom vzťahu je odpor <span><span class=MathJax_Preview>R_{FOTO}</span><script type=math/tex>R_{FOTO}</script></span>. Poznamenajme, že so vzrastajúcou intenzitou osvetlenia odpor fotoodporu klesá. Tento jav spôsobuje pokles napätia <span><span class=MathJax_Preview>U_f</span><script type=math/tex>U_f</script></span>. Presvedčme sa o tom pomocou nasledujúcej úlohy.</p> <p>Vytvorte aplikáciu, ktorá každú sekundu odmeria napätie <span><span class=MathJax_Preview>U_f</span><script type=math/tex>U_f</script></span> na vstupe AD6 analógovo číslicového prevodníka (ADC) a získanú hodnotu vyšle prostredníctvom triedy <code>UART</code> na obrazovku PC.</p> <p>V rámci projektu využijeme už vytvorené súbory:</p> <p><code>BOARD_AVR.h, UART_BT.h, UART_BT.cpp</code></p> <p>Na úspešné riešenie úlohy je vhodné vytvoriť triedu <code>ADC1</code> (súbory ADC1.h a ADC1.cpp) umožňujúcu využívať analógovo číslicový prevodník. Túto triedu využijeme aj pri niektorých ďalších úlohách.</p> <p>Pred tým, než vytvoríme triedu <code>ADC1</code>, uveďme zopár informácií o analógovo-číslicovom prevodníku. Predpokladáme, že jeho základnú funkciu poznáte – má realizovať transformáciu spojitého signálu na diskrétny ekvivalent. To znamená, že spojitý signál v čase i v úrovni nahradí postupnosťou čísel.</p> <h2 id=analogovo-cislicovy-prevodnik>Analógovo-číslicový prevodník<a class=headerlink href=#analogovo-cislicovy-prevodnik title="Permanent link">&para;</a></h2> <ul> <li>10 bitové rozlíšenie,</li> <li>integrálna nelinearita 0.5 LSB,</li> <li>absolútna presnosť ±2 LSB,</li> <li>čas prevodu 13μs až 260μs, </li> <li>6, alebo 8 prepínateľných vstupných kanálov,</li> <li>vstupný rozsah 0 až Vcc,</li> <li>voliteľné referenčné napätie 1.1 V,</li> <li>teplotný senzor,</li> <li>opakovací režim prevodu, alebo jednorazový prevod,</li> <li>štart prevodu pri rôznych prerušeniach,</li> <li>prerušenie pri skončení prevodu,</li> <li>režim redukcie šumu.</li> </ul> <p><img alt=img src=../images/adc_diag.jpg></p> <h2 id=registre-ad-prevodnika>Registre A/D prevodníka<a class=headerlink href=#registre-ad-prevodnika title="Permanent link">&para;</a></h2> <h3 id=admux-register-multiplexora>ADMUX: Register multiplexora<a class=headerlink href=#admux-register-multiplexora title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>REFS1</strong></td> <td><strong>REFS0</strong></td> <td><strong>ADLAR</strong></td> <td><strong>-</strong></td> <td><strong>MUX3</strong></td> <td><strong>MUX2</strong></td> <td><strong>MUX1</strong></td> <td><strong>MUX0</strong></td> </tr> <tr> <td>Prístup</td> <td>R/W</td> <td>R/W</td> <td>R/W</td> <td>R</td> <td>R/W</td> <td>R/W</td> <td>R/W</td> <td>R/W</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p><strong>Bit 7:6 - REFS1:0:</strong> Výber zdroja referenčného napäti</p> <table> <thead> <tr> <th><strong>REFS1</strong></th> <th><strong>REFS0</strong></th> <th><strong>Zdroj referenčného napätia</strong></th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0</td> <td>Interná referencia je vypnutá, externé referenčné napätie je privedené na vývod AREF</td> </tr> <tr> <td>0</td> <td>1</td> <td>AVcc</td> </tr> <tr> <td>1</td> <td>0</td> <td>Rezervované</td> </tr> <tr> <td>1</td> <td>1</td> <td>Interná referencia 1.1V</td> </tr> </tbody> </table> <p><strong>Bit 5 - ADLAR:</strong> Umiestnenie výsledku v registroch ADCH a ADCL. Ak hodnota bitu ADLAR je log. jednotka, potom výsledok bude umiestnený tak, že horných 8 bitov bude v registri ADCH a 2 spodné bity v registri ADCL, v bitoch 7 a 6. V opačnom prípade bude spodných 8 bitov výsledku v registri ADCL a dva najvyššie bity v registri ADCL, v bitoch 1 a 0. </p> <p><strong>Bity 4:0 – MUX4:0</strong>: Výber kanála a voľba zosilnenia. Ak sa zmení hodnota týchto bitov počas prevodu, táto zmena sa prejaví až pri nasledujúcom prevode. </p> <table> <thead> <tr> <th><strong>MUX3:0</strong></th> <th><strong>Jednoduchý vstup</strong></th> </tr> </thead> <tbody> <tr> <td>0000</td> <td>ADC0</td> </tr> <tr> <td>0001</td> <td>ADC1</td> </tr> <tr> <td>0010</td> <td>ADC2</td> </tr> <tr> <td>0011</td> <td>ADC3</td> </tr> <tr> <td>0100</td> <td>ADC4</td> </tr> <tr> <td>0101</td> <td>ADC5</td> </tr> <tr> <td>0110</td> <td>ADC6</td> </tr> <tr> <td>0111</td> <td>ADC7</td> </tr> <tr> <td>1000</td> <td><div class="w3-container w3-green">Teplotný senzor</div></td> </tr> <tr> <td>1001</td> <td>Reserv.</td> </tr> <tr> <td>1010</td> <td>Reserv.</td> </tr> <tr> <td>1011</td> <td>Reserv.</td> </tr> <tr> <td>1100</td> <td>Reserv.</td> </tr> <tr> <td>1101</td> <td>Reserv.</td> </tr> <tr> <td>1110</td> <td>1.1V</td> </tr> <tr> <td>1111</td> <td>GND</td> </tr> </tbody> </table> <h3 id=adcsra-riadiaci-a-stavovy-register-ac-prevodnika>ADCSRA: Riadiaci a stavový register A/Č prevodníka<a class=headerlink href=#adcsra-riadiaci-a-stavovy-register-ac-prevodnika title="Permanent link">&para;</a></h3> <p><strong>Bit 7 - ADEN:</strong> Povolenie činnosti prevodníka. Zápisom log.1 do bitu ADEN sa povoľuje činnosť prevodníka.</p> <p><strong>Bit 6 - ADCS:</strong> Štart prevodu. Ak prevodník pracuje v jednorazovom režime, potom pred každým prevodom musí byť do bitu ADCS zapísaná hodnota log.1. Po skončení prevodu sa bit ADCS vynuluje.</p> <p><strong>Bit 5 - ADATE:</strong> Povolenie automatického štartu. Ak hodnota bitu ADATE je log.1, potom sa prevod začne na nábežnú hranu vybraného štartovacieho signálu. Výber zdroja štartovacieho signálu sa realizuje vhodným nastavením bitov ADTS v registri špeciálnych funkcií SFIOR. </p> <p><strong>Bit 4 - ADIF:</strong> Príznak prerušenia. Tento bit sa nastaví na hodnotu log.1 pri skončení prevodu. Bit ADIF sa automaticky vynuluje po výkone obsluhy zodpovedajúceho prerušenia. Alternatívne, môže byť bit ADIF vynulovaný zápisom log.1.</p> <p><strong>Bit 3 - ADIE:</strong> Povolenie prerušenia pri skončení prevodu. Ak bit ADIE je nastavený na log.1 a I-bit v S-registri je tiež nastavený bude povolené prerušenie pri skončení prevodu.</p> <p><strong>Bit 2:0 - ADPS2:0:</strong> Nastavenie deliaceho pomeru medzi hodinovou frekvenciou (XTAL) a frekvenciou hodinových impulzov do ADC podľa tabuľky.</p> <table> <thead> <tr> <th>ADSP2</th> <th>ADSP1</th> <th>ADSP1</th> <th>Deliaci pomer</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0</td> <td>0</td> <td>2</td> </tr> <tr> <td>0</td> <td>0</td> <td>1</td> <td>2</td> </tr> <tr> <td>0</td> <td>1</td> <td>0</td> <td>4</td> </tr> <tr> <td>0</td> <td>1</td> <td>1</td> <td>8</td> </tr> <tr> <td>1</td> <td>0</td> <td>0</td> <td>16</td> </tr> <tr> <td>1</td> <td>0</td> <td>1</td> <td>32</td> </tr> <tr> <td>1</td> <td>1</td> <td>0</td> <td>64</td> </tr> <tr> <td>1</td> <td>1</td> <td>1</td> <td>128</td> </tr> </tbody> </table> <h3 id=datove-registre-ac-prevodnika>Dátové registre A/Č prevodníka<a class=headerlink href=#datove-registre-ac-prevodnika title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>ADC9</strong></td> <td><strong>ADC8</strong></td> </tr> <tr> <td>Prístup</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p><strong>ADCH, (ADLAR=0)</strong></p> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>ADC7</strong></td> <td><strong>ADC6</strong></td> <td><strong>ADC5</strong></td> <td><strong>ADC4</strong></td> <td><strong>ADC3</strong></td> <td><strong>ADC2</strong></td> <td><strong>ADC1</strong></td> <td><strong>ADC0</strong></td> </tr> <tr> <td>Prístup</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p><strong>ADCL, (ADLAR=0)</strong></p> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>ADC9</strong></td> <td><strong>ADC8</strong></td> <td><strong>ADC7</strong></td> <td><strong>ADC6</strong></td> <td><strong>ADC5</strong></td> <td><strong>ADC4</strong></td> <td><strong>ADC3</strong></td> <td><strong>ADC2</strong></td> </tr> <tr> <td>Prístup</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p><strong>ADCH, (ADLAR=1)</strong></p> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>ADC1</strong></td> <td><strong>ADC0</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> </tr> <tr> <td>Prístup</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> <td>R</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p><strong>ADCL, (ADLAR=1)</strong></p> <div class="admonition note"> <p class=admonition-title>Poznámka</p> <p>Pripomíname, že po skončení prevodu sa výsledok nachádza v týchto registroch. V opakovacom režime je potrebné priebežne zaistiť čítanie týchto registrov. Register ADCL sa číta skôr než register ADCH.</p> </div> <p>Popíšeme ešte register špeciálnych funkcií, pretože jeho tri bity sa využívajú na definovanie štartu A/Č prevodu.</p> <h3 id=adcsrb-riadiaci-a-stavovy-register-b>ADCSRB riadiaci a stavový register B<a class=headerlink href=#adcsrb-riadiaci-a-stavovy-register-b title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>-</strong></td> <td>ACME</td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td><strong>-</strong></td> <td>ADTS2</td> <td>ADTS1</td> <td>ADTS0</td> </tr> <tr> <td>Prístup</td> <td>R</td> <td>R/W</td> <td>R</td> <td>R</td> <td>R</td> <td>R/W</td> <td>R/W</td> <td>R/W</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p><strong>ADCSRB</strong></p> <p><strong>Bit 6 – ACME</strong> 1 – (pri ADEN 0) výstup multiplexora je privedený na vstup analógového komparátora. </p> <p><strong>Bit 7:5 - ADTS2:0:</strong> V prípade, že je povolená činnosť prevodníka a bit ADATE v registri ADCSRA je nastavený na hodnotu log.1, potom uvedené tri bity definujú štartovanie A/Č prevodu podľa tabuľky.</p> <table> <thead> <tr> <th><strong>ADTS2</strong></th> <th><strong>ADTS1</strong></th> <th><strong>ADTS0</strong></th> <th><strong>Zdroj spúšťania A/Č prevodu</strong></th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0</td> <td>0</td> <td>Opakovací režim</td> </tr> <tr> <td>0</td> <td>0</td> <td>1</td> <td>Analógový komparátor</td> </tr> <tr> <td>0</td> <td>1</td> <td>0</td> <td>Externé prerušenie 0</td> </tr> <tr> <td>0</td> <td>1</td> <td>1</td> <td>Čítač/časovač0, zhoda obsahu s porovnávacím registrom A</td> </tr> <tr> <td>1</td> <td>0</td> <td>0</td> <td>Čítač/časovač0, pretečenie</td> </tr> <tr> <td>1</td> <td>0</td> <td>1</td> <td>Čítač/časovač1, zhoda obsahu s registrom B</td> </tr> <tr> <td>1</td> <td>1</td> <td>0</td> <td>Čítač/časovač1, pretečenie</td> </tr> <tr> <td>1</td> <td>1</td> <td>1</td> <td>Čítač/časovač1, záchytná udalosť</td> </tr> </tbody> </table> <p><strong>DIDR0 register pre zákaz digitálnych vstupov</strong></p> <table> <thead> <tr> <th>Bit</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> </tr> </thead> <tbody> <tr> <td>Symbol</td> <td><strong>-</strong></td> <td>-</td> <td><strong>ADC5D</strong></td> <td><strong>ADC4D</strong></td> <td><strong>ADC3D</strong></td> <td><strong>ADC2D</strong></td> <td><strong>ADC1D</strong></td> <td><strong>ADC0D</strong></td> </tr> <tr> <td>Prístup</td> <td>R</td> <td>R/W</td> <td>R</td> <td>R</td> <td>R</td> <td>R/W</td> <td>R/W</td> <td>R/W</td> </tr> <tr> <td>P. hod.</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr> </tbody> </table> <p>Zápisom log.1 sa zakazuje činnosť vstupného vyrovnávacieho registra. Pri čítaní hodnoty na vývode PINx sa teraz prečíta hodnota log.0. Zápisom logickej jednotky do príslušného bitu registra DIDR0 sa redukuje spotreba vstupného registra.</p> <h2 id=implementacia-triedy-adc1>Implementácia triedy ADC1<a class=headerlink href=#implementacia-triedy-adc1 title="Permanent link">&para;</a></h2> <div class=tabbed-set data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>ADC1.h</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=cp>#ifndef __ADC_H__</span>
<span class=cp>#define __ADC_H__</span>
<span class=cp>#include</span> <span class=cpf>&quot;BOARD_AVR.h&quot;</span><span class=cp></span>

<span class=k>class</span> <span class=nc>ADC1</span>
<span class=p>{</span>
    <span class=c1>//variables</span>
<span class=k>public</span><span class=o>:</span>
<span class=k>protected</span><span class=o>:</span>
<span class=k>private</span><span class=o>:</span>
    <span class=c1>//functions</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>ADC1</span><span class=p>();</span>
    <span class=o>~</span><span class=n>ADC1</span><span class=p>();</span>

    <span class=kt>void</span> <span class=nf>Init_ADC</span><span class=p>(</span><span class=kt>uint8_t</span> <span class=n>clock</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>mode</span><span class=p>);</span> <span class=c1>// clk 000 2, 001 2, 010  4,  8,           //16, 32, 64, 128    opakovany rezim: true; jednorazov: false</span>
    <span class=kt>void</span> <span class=nf>Set_CHANNEL</span><span class=p>(</span><span class=kt>uint8_t</span><span class=p>);</span>               <span class=c1>// vyber kanal 0-7</span>
    <span class=kt>void</span> <span class=nf>Set_REF</span><span class=p>(</span><span class=kt>uint8_t</span><span class=p>);</span>                   <span class=c1>// vyber referencne napatie</span>
    <span class=kt>int</span> <span class=nf>Get_ADC</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>                       <span class=c1>// vrat vysledok prevodu 10-bitov</span>
    <span class=kt>uint8_t</span> <span class=nf>Get_ADC8</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>                  <span class=c1>// vrat vysledok prevodu 8-bitov</span>

<span class=k>protected</span><span class=o>:</span>
<span class=k>private</span><span class=o>:</span>
<span class=p>};</span> <span class=c1>//ADC</span>

<span class=cp>#endif </span><span class=c1>//__ADC_H__</span>
</code></pre></div> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>ADC1.cpp</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=cp>#include</span> <span class=cpf>&quot;ADC.h&quot;</span><span class=cp></span>

<span class=n>ADC1</span><span class=o>::</span><span class=n>ADC1</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>PRR</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>PRADC</span><span class=p>);</span> <span class=c1>//enable ADC</span>
<span class=p>}</span> <span class=c1>//ADC_Solar</span>

<span class=c1>// default destructor</span>
<span class=n>ADC1</span><span class=o>::~</span><span class=n>ADC1</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>PRR</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>PRADC</span><span class=p>);</span> <span class=c1>//disable ADC</span>
<span class=p>}</span> <span class=c1>//~ADC_Solar</span>
<span class=kt>void</span> <span class=n>ADC1</span><span class=o>::</span><span class=n>Init_ADC</span><span class=p>(</span><span class=kt>uint8_t</span> <span class=n>hod</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>rezim</span><span class=p>)</span>
<span class=p>{</span>                              <span class=c1>//false progr.start</span>
    <span class=n>hod</span> <span class=o>=</span> <span class=n>hod</span> <span class=o>&amp;</span> <span class=mh>0x7</span><span class=p>;</span>           <span class=c1>//</span>
    <span class=n>ADCSRA</span> <span class=o>=</span> <span class=mi>0</span><span class=n>b10000000</span> <span class=o>|</span> <span class=n>hod</span><span class=p>;</span> <span class=c1>//  ADEN, ADSC, ADATE, ADIF, ADIE,ADPS2,1,0</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>rezim</span><span class=p>)</span>
        <span class=n>ADCSRA</span> <span class=o>|=</span> <span class=mh>0x20</span><span class=p>;</span> <span class=c1>// ADATE: autotriger;</span>
<span class=p>}</span>

<span class=kt>void</span> <span class=n>ADC1</span><span class=o>::</span><span class=n>Set_CHANNEL</span><span class=p>(</span><span class=kt>uint8_t</span> <span class=n>kanal</span><span class=p>)</span>
<span class=p>{</span> <span class=c1>//kanal 0- F</span>
    <span class=n>kanal</span> <span class=o>&amp;=</span> <span class=mh>0x0F</span><span class=p>;</span>
    <span class=n>ADMUX</span> <span class=o>&amp;=</span> <span class=mh>0xF0</span><span class=p>;</span>
    <span class=n>ADMUX</span> <span class=o>|=</span> <span class=n>kanal</span><span class=p>;</span>             <span class=c1>//AVCC  010... 10bit  0110... 8bit - ADLAR=1</span>
<span class=p>};</span>                              <span class=c1>//REFS0, REFS1, ADLAR, RES, MUX....</span>
<span class=kt>void</span> <span class=n>ADC1</span><span class=o>::</span><span class=n>Set_REF</span><span class=p>(</span><span class=kt>uint8_t</span> <span class=n>ref</span><span class=p>)</span> <span class=c1>//REFS0; REFS1;: 0..00 ext ref, 1..01 AVcc, 2..10 res, //3..11 intref 1.1V</span>
<span class=p>{</span>
    <span class=n>ref</span> <span class=o>=</span> <span class=n>ref</span> <span class=o>&amp;</span> <span class=mi>0</span><span class=n>b00000011</span><span class=p>;</span> <span class=c1>//mask</span>
    <span class=n>ADMUX</span> <span class=o>&amp;=</span> <span class=mi>0</span><span class=n>b00111111</span><span class=p>;</span>
    <span class=n>ADMUX</span> <span class=o>|=</span> <span class=p>(</span><span class=n>ref</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>);</span>
<span class=p>};</span>

<span class=kt>int</span> <span class=n>ADC1</span><span class=o>::</span><span class=n>Get_ADC</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>ADMUX</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADLAR</span><span class=p>);</span> <span class=c1>// ADLAR=0   0b11011111;</span>
    <span class=n>ADCSRA</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADSC</span><span class=p>);</span>  <span class=c1>// start</span>
    <span class=k>while</span> <span class=p>((</span><span class=n>ADCSRA</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADIF</span><span class=p>))</span> <span class=o>!=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADIF</span><span class=p>))</span>
    <span class=p>{</span>
    <span class=p>};</span> <span class=c1>//caka na koniec prevodu</span>
    <span class=kt>int</span> <span class=n>prev</span> <span class=o>=</span> <span class=n>ADCL</span><span class=p>;</span>
    <span class=n>prev</span> <span class=o>|=</span> <span class=n>ADCH</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>;</span>
    <span class=n>ADCSRA</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADIF</span><span class=p>);</span> <span class=c1>//alternativa k vynulovaniu ADIF</span>
    <span class=k>return</span> <span class=n>prev</span><span class=p>;</span>
<span class=p>};</span>

<span class=kt>uint8_t</span> <span class=n>ADC1</span><span class=o>::</span><span class=n>Get_ADC8</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>ADMUX</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADLAR</span><span class=p>);</span> <span class=c1>//ADLAR=1</span>
    <span class=n>ADCSRA</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADSC</span><span class=p>);</span> <span class=c1>// start</span>
    <span class=k>while</span> <span class=p>((</span><span class=n>ADCSRA</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADIF</span><span class=p>))</span> <span class=o>!=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADIF</span><span class=p>))</span>
    <span class=p>{</span>
    <span class=p>};</span> <span class=c1>//caka na koniec prevodu</span>
    <span class=kt>uint8_t</span> <span class=n>ppom</span> <span class=o>=</span> <span class=n>ADCH</span><span class=p>;</span>
    <span class=n>ADCSRA</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>ADIF</span><span class=p>);</span> <span class=c1>//alternativa k vynulovaniu ADIF</span>
    <span class=k>return</span> <span class=n>ppom</span><span class=p>;</span>
<span class=p>};</span>
</code></pre></div> </div> </div> <h3 id=priklady-pouzitia>Príklady použitia<a class=headerlink href=#priklady-pouzitia title="Permanent link">&para;</a></h3> <p>Príklad použitia triedy ADC1 v main.cpp. Po zapnutí čaká na stlačenie tlačidla USR. Inicializuje sa prevodník a nastavia sa jeho parametre. V nekonečnej slučke každých 100ms sa odmeria napätie na fotoodpore a rozsvieti sa červená, alebo modrá dióda na základe intenzity osvetlenia.</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span> <span class=cpf>&quot;BOARD_AVR.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;RGB.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;AKU.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;TLACIDLO.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;ADC.h&quot;</span><span class=cp></span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>RGB</span> <span class=n>r</span><span class=p>;</span>
    <span class=n>AKU</span> <span class=n>a</span><span class=p>;</span>
    <span class=n>TLAC</span> <span class=n>t</span><span class=p>;</span>

    <span class=n>r</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>true</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>a</span><span class=p>.</span><span class=n>pip</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
        <span class=n>_delay_ms</span><span class=p>(</span><span class=mi>500</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>Get_Tlacidlo</span><span class=p>())</span>
            <span class=k>break</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>r</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>
    <span class=n>ADC1</span> <span class=n>adc</span><span class=p>;</span>
    <span class=n>adc</span><span class=p>.</span><span class=n>Init_ADC</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span> <span class=c1>//hodiny/64  jednorazovy prevod</span>
    <span class=n>adc</span><span class=p>.</span><span class=n>Set_CHANNEL</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span>
    <span class=n>adc</span><span class=p>.</span><span class=n>Set_REF</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// Avcc</span>
    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>adc</span><span class=p>.</span><span class=n>Get_ADC</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>300</span><span class=p>)</span>
            <span class=n>r</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>true</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>
        <span class=k>else</span>
            <span class=n>r</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
        <span class=n>_delay_ms</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>Ďalší príklad každú sekundu okrem svetelnej signalizácie vypisuje na obrazovku PC namerané hodnoty.</p> <div class=highlight><pre><span></span><code><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>RGB</span> <span class=n>r</span><span class=p>;</span>
    <span class=n>AKU</span> <span class=n>a</span><span class=p>;</span>
    <span class=n>TLAC</span> <span class=n>t</span><span class=p>;</span>
    <span class=n>UART_BT</span> <span class=n>uart</span><span class=p>;</span>

    <span class=n>uart</span><span class=p>.</span><span class=n>Uart_int</span><span class=p>();</span> <span class=c1>//115200, 8N1</span>
    <span class=n>uart</span><span class=p>.</span><span class=n>Uart_send</span><span class=p>(</span><span class=s>&quot;Tets fotoodpora</span><span class=se>\n\r</span><span class=s>&quot;</span><span class=p>);</span>

    <span class=n>r</span><span class=p>.</span><span class=n>Zhasni_Vsetko_RGB</span><span class=p>();</span>
    <span class=n>ADC1</span> <span class=n>adc</span><span class=p>;</span>
    <span class=n>adc</span><span class=p>.</span><span class=n>Init_ADC</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span> <span class=c1>//hodiny/64  jednorazovy prevod</span>
    <span class=n>adc</span><span class=p>.</span><span class=n>Set_CHANNEL</span><span class=p>(</span><span class=mi>6</span><span class=p>);</span>
    <span class=n>adc</span><span class=p>.</span><span class=n>Set_REF</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span> <span class=c1>// Avcc</span>

    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>uart</span><span class=p>.</span><span class=n>Uart_send</span><span class=p>(</span><span class=n>adc</span><span class=p>.</span><span class=n>Get_ADC</span><span class=p>());</span>
        <span class=n>uart</span><span class=p>.</span><span class=n>Uart_send</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\r</span><span class=s>&quot;</span><span class=p>);</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>adc</span><span class=p>.</span><span class=n>Get_ADC</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>300</span><span class=p>)</span>
            <span class=n>r</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>true</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>
        <span class=k>else</span>
            <span class=n>r</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
        <span class=n>_delay_ms</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label> <a href=../pr4/ title="Príklad 4 „UART“" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Späť </span> Príklad 4 „UART“ </div> </div> </a> <a href=../pr6/ title="Prerušovací podsystém" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Ďalej </span> Prerušovací podsystém </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Juraj Miček </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/friktk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.83fe6e3c.min.js></script> <script src=../assets/javascripts/bundle.7e1cb91c.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Kop\u00edrova\u0165 do schr\u00e1nky", "clipboard.copied": "Skop\u00edrovan\u00e9 do schr\u00e1nky", "search.config.lang": "", "search.config.pipeline": "", "search.config.separator": "", "search.result.placeholder": "Pre vyh\u013ead\u00e1vanie za\u010dni p\u00edsa\u0165", "search.result.none": "\u017diadne vyhovuj\u00face dokumenty", "search.result.one": "Vyhovuj\u00faci dokument: 1", "search.result.other": "Vyhovuj\u00face dokumenty: #"}</script> <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
<!doctype html><html lang=sk class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Výučbový systém BT-car3"><link href=https://friktk.github.io/LetnaSkola2020/pr3/ rel=canonical><meta name=author content="Martin Húdik"><link rel="shortcut icon" href=../images/icon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.5"><title>Príklad 3 „TLAČIDLO“ - BT-car3</title><link rel=stylesheet href=../assets/stylesheets/main.df84b5fe.min.css><link rel=stylesheet href=../assets/stylesheets/palette.8435c73a.min.css><meta name=theme-color content=#3f51b5><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/w3.css></head> <body dir data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label> <a href=https://friktk.github.io/LetnaSkola2020/ title=BT-car3 class="md-header-nav__button md-logo" aria-label=BT-car3> <img src=../images/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> BT-car3 </span> <span class="md-header-nav__topic md-ellipsis"> Príklad 3 „TLAČIDLO“ </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Hľadať placeholder=Hľadať autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/friktk/LetnaSkola2020.git title="Zobraziť repozitár" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> LetnaSkola 2020 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class="md-tabs__link md-tabs__link--active"> BT-car3 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://friktk.github.io/LetnaSkola2020/ title=BT-car3 class="md-nav__button md-logo" aria-label=BT-car3> <img src=../images/logo.svg alt=logo> </a> BT-car3 </label> <div class=md-nav__source> <a href=https://github.com/friktk/LetnaSkola2020.git title="Zobraziť repozitár" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> LetnaSkola 2020 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1 checked> <label class=md-nav__link for=nav-1> BT-car3 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=BT-car3 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> BT-car3 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Úvod class=md-nav__link> Úvod </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2 checked> <label class=md-nav__link for=nav-1-2> Príklady <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Príklady data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Príklady </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../pr1/ title="Príklad 1 „RGB_LED“" class=md-nav__link> Príklad 1 „RGB_LED“ </a> </li> <li class=md-nav__item> <a href=../pr2/ title="Príklad 2 „RGB_AKU“" class=md-nav__link> Príklad 2 „RGB_AKU“ </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ title="Príklad 3 „TLAČIDLO“" class="md-nav__link md-nav__link--active"> Príklad 3 „TLAČIDLO“ </a> </li> <li class=md-nav__item> <a href=../pr4/ title="Príklad 4 „UART“" class=md-nav__link> Príklad 4 „UART“ </a> </li> <li class=md-nav__item> <a href=../pr5/ title="Príklad 5 „Fotoodpor“" class=md-nav__link> Príklad 5 „Fotoodpor“ </a> </li> <li class=md-nav__item> <a href=../pr6/ title="Prerušovací podsystém" class=md-nav__link> Prerušovací podsystém </a> </li> <li class=md-nav__item> <a href=../pr7.md title=PWM class=md-nav__link> PWM </a> </li> <li class=md-nav__item> <a href=https://github.com/friktk/LetnaSkola2020/archive/ulohy.zip title=Download class=md-nav__link> Download </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Cvičenia <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Cvičenia data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Cvičenia </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://github.com/friktk/LetnaSkola2020/archive/triedy_cvicenie.zip title=Knižnica class=md-nav__link> Knižnica </a> </li> <li class=md-nav__item> <a href=https://github.com/friktk/LetnaSkola2020/tree/priklady/schema title=Schémy class=md-nav__link> Schémy </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../link/ title="Odkazy a návody" class=md-nav__link> Odkazy a návody </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Príklad 3 „TLAČIDLO“</h1> <p><strong>Projekt AVR1</strong></p> <p>Pri bližšom pohľade na modul AVR-board vidíme, že na doske sú umiestnené dve tlačidlá. Jedno s označením RST slúži na reštartovanie MCU, druhé s označením USR budeme využívať na modifikáciu behu programu, vetvenie a podobne. Z tohto dôvodu musíme byť schopní v priebehu výkonu programu identifikovať, či došlo ku stlačeniu tlačidla. Zapojenie tlačidla USR je uvedené na obrázku. Vidíme, že pri stlačení tlačidla na vývode PB0 sa objaví potenciál rovný GND, to je zjednodušene úroveň L. Ako bolo spomenuté vyššie táto úroveň zodpovedá logickej hodnote 0. Aká úroveň napätia bude na vývode PB0 v prípade, že tlačidlo nebude stlačené? Pokiaľ nezapneme príslušný pull-up odpor, tak na túto otázku nedokážeme jednoznačne odpovedať, prípadne ak stačí takáto odpoveď, tak tam bude tzv. neurčitá úroveň. MCU nedokáže jednoznačne interpretovať úroveň na príslušnom vstupe. Preto je potrebné v uvedenej aplikácii zapnúť pull-up odpor na vývode PB0 zapísaním log.1 do bitu PORTB0. Teraz, ak PB0 je v režime vstup (DDRB7 obsahuje log.0) je pri nestlačenom tlačidle na PB0 úroveň H. V prípade, že stlačíme tlačidlo na PB0 sa objaví úroveň L. </p> <p><img alt=img src=../images/schema_pr3.jpg#75size></p> <p>Keď už je funkcia tlačidla a jeho správania zrejmá, pristúpme k doplneniu predchádzajúceho projektu o triedu <code>TLACIDLO</code>. Postup je identický ako v prípade triedy <code>AKUC</code>, preto ho nebudeme komentovať. Po pridaní triedy <code>TLACIDLO</code> dostaneme dva súbory jeden s názvom <code>TLACIDLO.h</code> a druhý <code>TLACIDLO.cpp</code></p> <blockquote> <p>Štrukrúra projektu</p> <div class=highlight><pre><span></span><code>    .
    ├── AKUC.cpp
    ├── AKUC.h
    ├── BOARD_AVR.h
    ├── main.cpp
    ├── RGB_LED.cpp
    ├── RGB_LED.h
    ├── TLACIDLO.cpp <span class=c1># nové súbory</span>
    └── TLACIDLO.h   <span class=c1># nové súbory</span>
</code></pre></div> </blockquote> <p>Hlavičkový súbor <code>TLACIDLO.h</code> je jednoduchý:</p> <div class=highlight><pre><span></span><code><span class=n>define</span> <span class=n>__TLACIDLO_H__</span>
<span class=cp>#include</span> <span class=cpf>&quot;BOARD_AVR.h&quot;</span><span class=cp></span>

<span class=k>class</span> <span class=nc>TLACIDLO</span>
<span class=p>{</span>
<span class=c1>//variables</span>
<span class=k>public</span><span class=o>:</span>
<span class=k>protected</span><span class=o>:</span>
<span class=k>private</span><span class=o>:</span>

<span class=c1>//functions</span>
<span class=k>public</span><span class=o>:</span>
    <span class=n>TLACIDLO</span><span class=p>();</span>
    <span class=o>~</span><span class=n>TLACIDLO</span><span class=p>();</span>
    <span class=kt>bool</span> <span class=nf>get_Tlac</span><span class=p>(</span> <span class=kt>void</span><span class=p>);</span> <span class=err>#</span> <span class=n>Funkcia</span> <span class=n>nemá</span> <span class=n>argument</span> <span class=n>a</span> <span class=n>vracia</span> <span class=n>okamžitý</span> <span class=n>stav</span> <span class=n>tlačidla</span>  
<span class=k>protected</span><span class=o>:</span>
<span class=k>private</span><span class=o>:</span>

<span class=p>};</span> <span class=c1>//TLACIDLO</span>

<span class=cp>#endif </span><span class=c1>//__TLACIDLO_H__</span>
</code></pre></div> <p>Okrem konštruktora a deštruktora hlavičkový súbor obsahuje jedinú funkciu triedy TLACIDLO, <code>bool get_Tlac( void)</code>. Funkcia nemá argument a vracia okamžitý stav tlačidla. </p> <p>Súbor <code>TLACIDLO.cpp</code> obsahuje definície konštruktora a jednej funkcie <code>get_Tlac()</code>:</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span> <span class=cpf>&quot;TLACIDLO.h&quot;</span><span class=cp></span>

<span class=c1>// default constructor</span>
<span class=n>TLACIDLO</span><span class=o>::</span><span class=n>TLACIDLO</span><span class=p>()</span>
<span class=p>{</span>
    <span class=n>sbi</span><span class=p>(</span><span class=n>PORTB</span><span class=p>,</span><span class=n>TL</span><span class=p>);</span>      <span class=c1>// zopnutie pull-up odporu</span>
    <span class=n>cbi</span><span class=p>(</span><span class=n>DDRB</span><span class=p>,</span><span class=n>TL</span><span class=p>);</span>       <span class=c1>// urcenie smeru vyvodu PB0,  vstup.</span>
<span class=p>}</span> <span class=c1>//TLACIDLO</span>

<span class=c1>// default destructor</span>
<span class=n>TLACIDLO</span><span class=o>::~</span><span class=n>TLACIDLO</span><span class=p>()</span>
<span class=p>{</span>
<span class=p>}</span> <span class=c1>//~TLACIDLO</span>

<span class=kt>bool</span> <span class=n>TLACIDLO</span><span class=o>::</span><span class=n>get_Tlac</span><span class=p>(</span> <span class=kt>void</span><span class=p>){</span>
    <span class=kt>bool</span> <span class=n>stav</span><span class=p>;</span>
    <span class=n>stav</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
    <span class=k>if</span><span class=p>(</span> <span class=p>(</span><span class=n>PINB</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>TL</span><span class=p>))</span> <span class=o>!=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>TL</span><span class=p>)</span> <span class=p>)</span><span class=n>stav</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span> <span class=c1>// Test stlacenia</span>
    <span class=k>return</span> <span class=n>stav</span><span class=p>;</span>    
<span class=p>}</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Logické a bitové (bitwise) operácie v jazyku C++</p> <p>Je namieste pripomenúť logické a bitové (bitwise) operácie v jazyku C++. Symboly bitových operácií medzi jednotlivými bitmi slova sú označené jednoduchými znakmi. </p> <ul> <li>and: <code>&amp;</code>, or:<code>|</code>, XOR: <code>^</code></li> <li>posun doľava: <code>&lt;&lt;</code>, posun doprava: <code>&gt;&gt;</code></li> <li>bitová negácia <code>~</code>. </li> </ul> <p>Logické operácie sú s výnimkou negácie označené dvojicou rovnakých po sebe idúcich symbolov: </p> <ul> <li>and: <code>&amp;&amp;</code>, or: <code>||</code>, negácia: <code>!</code>. </li> </ul> <p>V teste stlačenia je použitá bitová operácia medzi obsahom 8-bitového „registra” PINB a 8-bitovou hodnotou <code>(1&lt;&lt;TL)</code>. (Ak v BOARD_AVR.h a avr/io.h je definované, že TL = 0, potom <code>(1&lt;&lt;TL) = 1</code>, v binárnom vyjadrení 0b00000001 ). </p> </div> <p>Teraz napíšme program, ktorý zabezpečí nasledujúce správanie modulu: po pripojení na napájacie napätie nebude svietiť žiadna dióda a bzučiak bude ticho. Po stlačení tlačidla USR nech sa na 1s zasvieti červená dióda a súčasne sa na sekundu spustí bzučiak. Potom sa čaká na ďalšie stlačenie. Uvádzame výpis programu „main()“, ktorý by s využitím známych tried mal zabezpečiť popísané správanie. Upozorňujeme, že uvedený kód nevyhovuje zadaniu. Čo je potrebné upraviť?</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span> <span class=cpf>&quot;AKUC.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;RGB_LED.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;TLACIDLO.h&quot;</span><span class=cp></span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>RGB_LED</span> <span class=n>led</span><span class=p>;</span>    <span class=c1>// vytvorenie instancie led triedy </span>
                    <span class=c1>//RGB_LED konstruktor nastavi vyvody</span>
    <span class=n>AKUC</span> <span class=n>aku</span><span class=p>;</span>
    <span class=n>TLACIDLO</span> <span class=n>tl</span><span class=p>;</span>            <span class=c1>// tl je meno objektu</span>
    <span class=n>TLACIDLO</span><span class=o>*</span> <span class=n>p_tl</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>tl</span><span class=p>;</span>   <span class=c1>//p_tl je pointer na objekt tl triedy TLACIDLO</span>

    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>       <span class=c1>//nekonecny cyklus</span>
    <span class=p>{</span>                       

        <span class=c1>// ukazka volania funkcie get_Tlac() pomocou pointra p_tl</span>
        <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=n>p_tl</span><span class=o>-&gt;</span><span class=n>get_Tlac</span><span class=p>()){};</span> <span class=c1>//pokial nie je stlac. stoji v tejto slucke </span>

        <span class=n>led</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>true</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>
        <span class=n>_delay_ms</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>    <span class=c1>//ako dlho bude svietit LED? Co sa stane ak vynecham </span>
                            <span class=c1>//delay?</span>
        <span class=n>aku</span><span class=p>.</span><span class=n>set_AKU</span><span class=p>(</span><span class=mi>1000</span><span class=p>);</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zhasni_Vsetko_RGB</span><span class=p>();</span>

    <span class=p>}</span>

    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>           

<span class=p>}</span>
</code></pre></div> <p>Všimnime si, že pri volaní funkcie <code>get_tlac()</code> je použité volanie prostredníctvom ukazovateľa (pointra) <code>p_tl</code> na objekt <code>tl</code>. Je zrejmé, že volať metódu triedy môžeme na základe jej mena. <code>tl.get_Tlac()</code> alebo pointra <code>p_tl-&gt;get_Tlac()</code>.</p> <p>Pokúste sa program modifikovať tak, aby po každom stlačení svietila iná farba. Farby nech svietia v poradí (červená, zelená, modrá, červená, zelená ....) a tak ďalej.</p> <div class=highlight><pre><span></span><code><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
    <span class=n>RGB_LED</span> <span class=n>led</span><span class=p>;</span> <span class=c1>// vytvorenie instancie led triedy RGB_LED konstruktor nastavi vyvody</span>
    <span class=n>AKUC</span> <span class=n>aku</span><span class=p>;</span>
    <span class=n>TLACIDLO</span> <span class=n>tl</span><span class=p>;</span>          <span class=c1>// tl je meno objektu</span>
    <span class=n>TLACIDLO</span> <span class=o>*</span><span class=n>p_tl</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>tl</span><span class=p>;</span> <span class=c1>//p_tl je pointer na objekt tl triedy TLACIDLO</span>

    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>//nekonecny cyklus</span>
    <span class=p>{</span>
        <span class=c1>// ukazka volania funkcie get_Tlac() pomocou pointra p_tl</span>
        <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>p_tl</span><span class=o>-&gt;</span><span class=n>get_Tlac</span><span class=p>())</span>
        <span class=p>{</span>
        <span class=p>};</span> <span class=c1>// pokial nie je stlacene stoji v tejto slucke</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zhasni_Vsetko_RGB</span><span class=p>();</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>true</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>

        <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>p_tl</span><span class=o>-&gt;</span><span class=n>get_Tlac</span><span class=p>())</span>
        <span class=p>{</span>
        <span class=p>};</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zhasni_Vsetko_RGB</span><span class=p>();</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>false</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>

        <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>p_tl</span><span class=o>-&gt;</span><span class=n>get_Tlac</span><span class=p>())</span>
        <span class=p>{</span>
        <span class=p>};</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zhasni_Vsetko_RGB</span><span class=p>();</span>
        <span class=n>led</span><span class=p>.</span><span class=n>Zasviet_RGB</span><span class=p>(</span><span class=nb>false</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Prečo to teraz uspokojivo nefunguje? Poznajme, že vysvetlenie súvisí už s hardvérom. Ak stlačíte tlačidlo, podržíte ho stlačené určitý čas. Počas tohto času sa vonkajší cyklus samozrejme mnohokrát zopakuje. Ako dôkaz si pozrite, že počas stlačenia tlačidla svietia všetky tri farby diódy. Ak tlačidlo pustíte ostane svietiť náhodná farba. Je zrejmé, že táto farba súvisí s okamihom, v ktorom tlačidlo pustíte. Aby bola situácia ešte zložitejšia pripomeňme, že tlačidlo je elektromechanický prvok, ktorý pri stlačení, alebo pustení môže generovať veľké množstvo zákmitov. Na vývode PB0 sa pri stlačení a pustení tlačidla objaví signál podľa obrázku. Navrhnite úpravu predchádzajúceho programu takú aby sa farba diódy menila v súlade so zadaním.</p> <p><img alt=img src=../images/zakmit.jpg#75size></p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Na mierne potlačenie uvedeného javu slúži kondenzátor C7. Nie všetky zákmity sa mu podarí eliminovať. Len pre fanúšikov elektroniky: kondenzátor C7 spolu s interným pull-up odporom vytvára akýsi filtračný obvod na eliminovanie krátkych impulzov na vývode PB0. Časová konštanta filtračného obvodu je približne daná súčinom RC. Dosadením hodnôt pull-up odporu a kondenzátora dostávame časovú konštantu: <span><span class=MathJax_Preview>RC = 50.10^{ 3}.10^{-7} = 5 ms</span><script type=math/tex>RC = 50.10^{ 3}.10^{-7}  = 5 ms</script></span>. Impulzy pod 1 ms by mali byť spoľahlivo odfiltrované. Stačí to, vybrané tlačidlo negeneruje dlhšie impulzy? O tom sa presvedčíme experimentálne. </p> </div> <p>Jedna z možných úprav kódu funkcie <code>get_Tlac()</code> je uvedená nižšie. Poznamenajme, že oneskorenie <code>_delay_ms(5)</code> je použité na ošetrenie tých spomínaných zákmitov tlačidla. Predpokladáme, že prechodový proces (prechod medzi stlačením a pustením tlačidla) netrvá dlhšie ako 5 ms.</p> <blockquote> <p>Súbor TLACIDLO.cpp</p> <div class=highlight><pre><span></span><code><span class=kt>bool</span> <span class=n>TLACIDLO</span><span class=o>::</span><span class=n>get_Tlac</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
  <span class=kt>bool</span> <span class=n>stav</span><span class=p>;</span>
  <span class=n>stav</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
  <span class=k>while</span> <span class=p>((</span><span class=n>PINB</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>TL</span><span class=p>))</span> <span class=o>!=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>TL</span><span class=p>))</span>
  <span class=p>{</span>
  <span class=p>};</span> <span class=c1>// caka pokial tlacidlo nie je</span>
     <span class=c1>//pustene</span>
  <span class=n>_delay_ms</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>

  <span class=k>if</span> <span class=p>((</span><span class=n>PINB</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>TL</span><span class=p>))</span> <span class=o>!=</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>TL</span><span class=p>))</span>
      <span class=n>stav</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span> <span class=c1>// testuje ci tlacidlo bolo</span>
                   <span class=c1>//stlacene</span>

  <span class=k>return</span> <span class=n>stav</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> </blockquote> <p>Všimnime si, že celý výpočtový výkon procesora je spotrebovaný na testovanie tlačidla. Ako to urobiť efektívnejšie? Aj na riešenie tohoto rébusu neskôr použijeme prerušovací systém.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label> <a href=../pr2/ title="Príklad 2 „RGB_AKU“" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Späť </span> Príklad 2 „RGB_AKU“ </div> </div> </a> <a href=../pr4/ title="Príklad 4 „UART“" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Ďalej </span> Príklad 4 „UART“ </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Juraj Miček </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/friktk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.83fe6e3c.min.js></script> <script src=../assets/javascripts/bundle.7e1cb91c.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Kop\u00edrova\u0165 do schr\u00e1nky", "clipboard.copied": "Skop\u00edrovan\u00e9 do schr\u00e1nky", "search.config.lang": "", "search.config.pipeline": "", "search.config.separator": "", "search.result.placeholder": "Pre vyh\u013ead\u00e1vanie za\u010dni p\u00edsa\u0165", "search.result.none": "\u017diadne vyhovuj\u00face dokumenty", "search.result.one": "Vyhovuj\u00faci dokument: 1", "search.result.other": "Vyhovuj\u00face dokumenty: #"}</script> <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>